<!DOCTYPE html>
<html>
    <head>
        <title>Exploit EternalBlue with Custom Exploit - 2</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Encode+Sans+SC&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../css/style.css">
        <meta name="description" content="This tutorial demonstrates how to exploit a Windows 7 machine that is vulnerable to the EternalBlue exploit download from Exploit Database.">
        <meta name="keywords" content="kali, linux, kali linux, eternal, blue, eternalblue, eternal blue, eternalblue exploit, external blue exploit, externalblue exploit database, eternal blue exploit database, exploit database, exploit-db.com">
        <meta name="author" content="0xma">
    </head>
    <body>
        <header class="header">
            <div class="text-box">
                <h1 class="heading-primary">
                    <span class="heading-primary-main">0xma</span>
                    <span class="heading-primary-sub">Cyber Security Articles</span>
                </h1>
            </div>
            <div class="nav_box">
                <ul class="nav_ul">
                    <li class="nav_li"><a href="https://twitter.com/0xmaCyberSec">About</a></li>
                    <li class="nav_li"><a href="https://github.com/0xma/">GitHub</a></li>
                    <li class="nav_li"><a href="index.html">Hacking Articles</a></li>
                    <li class="nav_li"><a href="../index.html">Home</a></li>
                </ul>    
            </div>
        </header>
        <br>
        <br>
        <br>
        <div class="container">
            <div class="left_empty_space"></div>
            <div class="center">
                <p class="date">April 9, 2021</p>
                <h1 class="heading">Exploit EternalBlue with Custom Exploit - 2</h1>
                <p>In this tutorial we will see how to gain access to a remote computer using the EternalBlue exploit. EternalBlue exploits a vulnerability in Microsoft's implementation of the Server Message Block (SMB) protocol. This vulnerability is denoted by CVE-2017-0144. The vulnerability exists because the SMB version 1 (SMBv1) server in various versions of Microsoft Windows mishandles specially crafted packets from remote attackers, allowing them to execute arbitrary code on the target computer.</p>
                <p>Let's download the exploit from the Exploit Database (exploit-db.com).</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/201.png" alt="Exploit page in the Exploit Database (www.exploit-db.com).">
                <br>
                <br>
                <p>Once the exploit is downloaded, let's move it to the current working directory and rename it to eternalblue_exploit.py.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/202.png" alt="Renaming the script into something readable.">
                <br>
                <br>
                <p>We need mysmb.py for this exploit to work.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/203.png" alt="mysmb.py script in GitHub.">
                <br>
                <br>
                <p>This shows the raw mysmb.py script.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/204.png" alt="mysmb.py script in raw format.">
                <br>
                <br>
                <p>Let's download it using wget.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/205.png" alt="Downloading the mysmb.py script from GitHub.">
                <br>
                <br>
                <p>For this exploit to work, we need to generate a reverse shell in the format of an executable. msfvenom is a good choice to perform this task.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/206.png" alt="Generating a .exe payload with msfvenom.">
                <br>
                <br>
                <p>This is the original smb_pwn() function in the eternalblue_exploit.py file.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/207.png" alt="Default contents of the smb_pwn() function.">
                <br>
                <br>
                <p>However, we need to modify it by including the path to the generated reverse shell file and then add another line to execute the reverse shell.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/208.png" alt="Modifying the smb_pwn() function.">
                <br>
                <br>
                <p>The script has the USERNAME set to empty.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/209.png" alt="Default values of the USERNAME and PASSWORD variables in the script.">
                <br>
                <br>
                <p>In order for the exploit to work, we have to set the USERNAME to guest.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/210.png" alt="Setting the USERNAME variable.">
                <br>
                <br>
                <p>Let's create a Metasploit listener to receive the connection back from the target.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/211.png" alt="Creating a multi/handler listener in Metasploit.">
                <br>
                <br>
                <p>Once the listener is created, we execute the exploit by specifying the IP address of the target.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/212.png" alt="Executing the exploit script.">
                <img src="../img/exploit_eternalblue_with_custom_script_2/213.png" alt="Executing the exploit script.">
                <br>
                <br>
                <p>If the exploit gets executed successfully, we can receive our reverse shell from the target.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/214.png" alt="meterpreter shell on the target box.">
                <br>
                <br>
                <p>Running <span class="command">sysinfo</span> which is a built-in meterpreter command shows system information.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/215.png" alt="sysinfo command in meterpreter.">
                <br>
                <br>
                <p><span class="command">getuid</span> which again is a built-in meterpreter command shows us that we have system level privileges on the box.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_2/216.png" alt="getuid command in meterpreter.">
                <br>
                <br>
                <br>
                <br>
                <br>
            </div>
            <div class="right_margin">
                <div id="right_margin_widget">
                    <div class="widget_title">Related Tutorials</div>
                    <hr>
                    <ul class="remove_bullet_points">
                        <li class="style_bullet_points"><a href="../hacking/escalate_regular_shell_to_meterpreter_shell.html" class="widget_links">Escalate a Regular Shell to Meterpreter Shell</a></li>
                        <li class="style_bullet_points"><a href="../hacking/reading_outlook_pst_files.html" class="widget_links">Reading Outlook Files in Terminal</a></li>
                        <li class="style_bullet_points"><a href="../hacking/metasploit_privilege_escalation.html" class="widget_links">Escalating Privileges with Metasploit's Local Exploit Suggester</a></li>
                        <li class="style_bullet_points"><a href="../hacking/simple_powershell_wget_script.html" class="widget_links">Simple wget PowerShell Script</a></li>
                        <li class="style_bullet_points"><a href="../hacking/psexec_in_linux.html" class="widget_links">PsExec in Linux</a></li>
                        <li class="style_bullet_points"><a href="../hacking/eternal_blue_metasploit.html" class="widget_links">Eternal Blue Exploitation with Metasploit</a></li>
                        <li class="style_bullet_points"><a href="../hacking/exploit_eternalblue_with_custom_script_1.html" class="widget_links">Exploit EternalBlue with Custom Exploit - 1</a></li>
                        <li class="style_bullet_points"><a href="../hacking/exploit_eternalblue_with_custom_script_2.html" class="widget_links">Exploit EternalBlue with Custom Exploit - 2</a></li>
                        <li class="style_bullet_points"><a href="../hacking/local_privilege_escalation_on_linux_kernel.html" class="widget_links">Local Privilege Escalation on Linux Kernel < 4.4.0-116</a></li>
                        <li class="style_bullet_points"><a href="../hacking/extract_firefox_profile_passwords.html" class="widget_links">Extract Passwords from Firefox Profile</a></li>
                    </ul>
                </div>
                <div id="right_margin_widget">
                    <div class="widget_title">Latest Tutorials</div>
                    <hr>
                    <ul class="remove_bullet_points">
                        <li class="style_bullet_points"><a href="../hacking/escalate_privileges_via_pip.html" class="widget_links">Escalate Privileges via pip</a></li>
                        <li class="style_bullet_points"><a href="../hacking/modifying_etc_passwd_file.html" class="widget_links">Escalate Privileges by Modifying the /etc/passwd File</a></li>
                        <li class="style_bullet_points"><a href="../hacking/wpadmin_shell_upload.html" class="widget_links">wp_admin_shell_upload</a></li>
                        <li class="style_bullet_points"><a href="../hacking/extract_passwords_with_lazagne.html" class="widget_links">Extract Passwords with LaZagne</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_2016_medusa.html" class="widget_links">Bruteforce Windows Server SMB Credentials with Medusa</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_2016_hydra.html" class="widget_links">Brute Force Windows Server SMB Credentials with Hydra</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_2016_ncrack.html" class="widget_links">Brute Force Windows Server SMB Credentials with NCrack</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_crackmapexec.html" class="widget_links">Brute Force Windows Server SMB Credentials with CrackMapExec</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_metasploit.html" class="widget_links">Brute Force Windows Server SMB Credentials with Metasploit</a></li>
                        <li class="style_bullet_points"><a href="../hacking/exploit_printnightmare.html" class="widget_links">Exploit PrintNightmare</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="right_empty_space"></div>
        <footer>
            <div class="footer">
                <span class="copyright">Copyright &copy; 2022</span>
            </div>
        </footer>
    </body>
</html>