<!DOCTYPE html>
<html>
    <head>
        <title>Exploit EternalBlue with Custom Exploit - 1</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Encode+Sans+SC&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../css/style.css">
        <meta name="description" content="This tutorial demonstrates how to exploit a Windows 7 machine that is vulnerable to the EternalBlue exploit download from GitHub.">
        <meta name="keywords" content="kali, linux, kali linux, eternal, blue, eternalblue, eternal blue, eternalblue exploit, external blue exploit, externalblue github, eternal blue github, github">
        <meta name="author" content="0xma">
    </head>
    <body>
        <header class="header">
            <div class="text-box">
                <h1 class="heading-primary">
                    <span class="heading-primary-main">0xma</span>
                    <span class="heading-primary-sub">Cyber Security Articles</span>
                </h1>
            </div>
            <div class="nav_box">
                <ul class="nav_ul">
                    <li class="nav_li"><a href="https://twitter.com/0xmaCyberSec">About</a></li>
                    <li class="nav_li"><a href="https://github.com/0xma/">GitHub</a></li>
                    <li class="nav_li"><a href="index.html">Hacking Articles</a></li>
                    <li class="nav_li"><a href="../index.html">Home</a></li>
                </ul>    
            </div>
        </header>
        <br>
        <br>
        <br>
        <div class="container">
            <div class="left_empty_space"></div>
            <div class="center">
                <p class="date">April 2, 2021</p>
                <h1 class="heading">Exploit EternalBlue with Custom Exploit - 1</h1>
                <p>In this tutorial we will see how to gain access to a remote computer using the EternalBlue exploit. EternalBlue exploits a vulnerability in Microsoft's implementation of the Server Message Block (SMB) protocol. This vulnerability is denoted by CVE-2017-0144. The vulnerability exists because the SMB version 1 (SMBv1) server in various versions of Microsoft Windows mishandles specially crafted packets from remote attackers, allowing them to execute arbitrary code on the target computer.</p>
                <p>We can download the exploit from this Github page.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/101.png" alt="Exploit page in GitHub.">
                <br>
                <br>
                <p>This gives a quick description of the exploit.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/102.png" alt="A quick introduction to the exploit in GitHub.">
                <br>
                <br>
                <p>The Requirements section lists all the things we have to have on our system for the exploit to work.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/103.png" alt="Requirements section from the GitHub page.">
                <br>
                <br>
                <p>Let's clone the exploit to our local machine.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/104.png" alt="Cloning the exploit directory.">
                <br>
                <br>
                <p>This shows the contents of the exploit directory. Note the requirements.txt file which contains all the Python modules that we need for this exploit to work.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/105.png" alt="Contents of the exploit directory.">
                <br>
                <br>
                <p>To install all the Python modules in the requirements.txt file we need to run <span class="command">pip2.7 install -r requirements.txt</span>.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/106.png" alt="Installing the requirements.">
                <br>
                <br>
                <p>In order to check if the target system is patched against this exploit or not, we have to run the "eternal_checker.py" file followed by the IP address of the target box. In this particular instance, we can see that the target is not patched.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/107.png" alt="Executing the eternal_checker.py script.">
                <br>
                <br>
                <p>Let's move to the shellcode directory. This directory will contain the shellcodes that we would want to run on the target.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/108.png" alt="Contents of the exploit directory.">
                <br>
                <br>
                <p>In order to generate our shellcode, we need to run the "shell_prep.sh" script. It prompts us to enter the local IP address, the ports on which we will be listening depending whether the payload is 32-bit or 64-bit, what kind of a shell we want to generate (meterpreter or regular) and also whether we want the payload to be staged or stageless.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/109.png" alt="Execution of the shell_prep.sh script.">
                <img src="../img/exploit_eternalblue_with_custom_script_1/110.png" alt="Execution of the shell_prep.sh script.">
                <br>
                <br>
                <p>We can see that seven .bin files have been generated which can be used on the target depending on its architecture.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/111.png" alt="Contents of the exploit directory.">
                <br>
                <br>
                <p>Let's move back a directory and see what others files are there that we need to run.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/112.png" alt="Contents of the exploit directory.">
                <br>
                <br>
                <p>In order to connect to the target, we have to be listening for connections from the target computer. "listener_prep.sh" prompts us to enter the IP address of the interface on which we will be listening along with the specific ports to which our payload will connect (we have two different ports, one for the 32-bit payload and the other for the 64-bit payload), in addition to that we have to specify the type of shell that we will be expecting (meterpreter or regular) and also the type of payload that will be connecting back to us (staged or stageless).</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/113.png" alt="Executing the listener_prep.sh file.">
                <img src="../img/exploit_eternalblue_with_custom_script_1/114.png" alt="Executing the listener_prep.sh file.">
                <br>
                <br>
                <p>We have three different exploit files: eternalblue_exploit10.py, eternalblue_exploit8.py and eternalblue_exploit7.py. These exploits work for different versions of Windows: Windows 10, Windows 8 and Windows 7.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/115.png" alt="Contents of the exploit directory.">
                <br>
                <br>
                <p>Since our target is a Windows 7 box, we will be running the eternalblue_exploit7.py script. Note that for the first argument, this script takes the IP address of the target box. And for the second argument, it takes the shellcode that we generated earlier. We are using the sc_all.bin shellcode for this instance.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/116.png" alt="Executing the exploit with the sc_all.bin shellcode.">
                <br>
                <br>
                <p>Note that if we know the architecture of our target, we can use a specific shellcode as well. Since I know that the target is running a 64-bit Windows 7 machine, I can use the sc_x64.bin shellcode as well.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/117.png" alt="Executing the exploit with the sc_x64.bin shellcode.">
                <br>
                <br>
                <p>Once the exploit is executed successfully, we can see that we receive a connection back from the target box.</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/118.png" alt="Received a connection back from the target.">
                <br>
                <br>
                <p>Now we can interact with the target and run whichever command we choose. Note that we have system level privileges to the box which means we can bring any changes that we want (from installing software to deleting important files, etc).</p>
                <img src="../img/exploit_eternalblue_with_custom_script_1/119.png" alt="Metasploit regular shell to the target box.">                
                <br>
                <br>
                <br>
                <br>
                <br>
            </div>
            <div class="right_margin">
                <div id="right_margin_widget">
                    <div class="widget_title">Related Tutorials</div>
                    <hr>
                    <ul class="remove_bullet_points">
                        <li class="style_bullet_points"><a href="../hacking/escalate_regular_shell_to_meterpreter_shell.html" class="widget_links">Escalate a Regular Shell to Meterpreter Shell</a></li>
                        <li class="style_bullet_points"><a href="../hacking/reading_outlook_pst_files.html" class="widget_links">Reading Outlook Files in Terminal</a></li>
                        <li class="style_bullet_points"><a href="../hacking/metasploit_privilege_escalation.html" class="widget_links">Escalating Privileges with Metasploit's Local Exploit Suggester</a></li>
                        <li class="style_bullet_points"><a href="../hacking/simple_powershell_wget_script.html" class="widget_links">Simple wget PowerShell Script</a></li>
                        <li class="style_bullet_points"><a href="../hacking/psexec_in_linux.html" class="widget_links">PsExec in Linux</a></li>
                        <li class="style_bullet_points"><a href="../hacking/eternal_blue_metasploit.html" class="widget_links">Eternal Blue Exploitation with Metasploit</a></li>
                        <li class="style_bullet_points"><a href="../hacking/exploit_eternalblue_with_custom_script_1.html" class="widget_links">Exploit EternalBlue with Custom Exploit - 1</a></li>
                        <li class="style_bullet_points"><a href="../hacking/exploit_eternalblue_with_custom_script_2.html" class="widget_links">Exploit EternalBlue with Custom Exploit - 2</a></li>
                        <li class="style_bullet_points"><a href="../hacking/local_privilege_escalation_on_linux_kernel.html" class="widget_links">Local Privilege Escalation on Linux Kernel < 4.4.0-116</a></li>
                        <li class="style_bullet_points"><a href="../hacking/extract_firefox_profile_passwords.html" class="widget_links">Extract Passwords from Firefox Profile</a></li>
                    </ul>
                </div>
                <div id="right_margin_widget">
                    <div class="widget_title">Latest Tutorials</div>
                    <hr>
                    <ul class="remove_bullet_points">
                        <li class="style_bullet_points"><a href="../hacking/escalate_privileges_via_pip.html" class="widget_links">Escalate Privileges via pip</a></li>
                        <li class="style_bullet_points"><a href="../hacking/modifying_etc_passwd_file.html" class="widget_links">Escalate Privileges by Modifying the /etc/passwd File</a></li>
                        <li class="style_bullet_points"><a href="../hacking/wpadmin_shell_upload.html" class="widget_links">wp_admin_shell_upload</a></li>
                        <li class="style_bullet_points"><a href="../hacking/extract_passwords_with_lazagne.html" class="widget_links">Extract Passwords with LaZagne</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_2016_medusa.html" class="widget_links">Bruteforce Windows Server SMB Credentials with Medusa</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_2016_hydra.html" class="widget_links">Brute Force Windows Server SMB Credentials with Hydra</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_2016_ncrack.html" class="widget_links">Brute Force Windows Server SMB Credentials with NCrack</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_crackmapexec.html" class="widget_links">Brute Force Windows Server SMB Credentials with CrackMapExec</a></li>
                        <li class="style_bullet_points"><a href="../hacking/brute_force_windows_server_metasploit.html" class="widget_links">Brute Force Windows Server SMB Credentials with Metasploit</a></li>
                        <li class="style_bullet_points"><a href="../hacking/exploit_printnightmare.html" class="widget_links">Exploit PrintNightmare</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="right_empty_space"></div>
        <footer>
            <div class="footer">
                <span class="copyright">Copyright &copy; 2022</span>
            </div>
        </footer>
    </body>
</html>